<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Employees - Attendance System</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i>ðŸ‘¤</i> Attendance System
                </div>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="register.html">Register</a></li>
                        <li><a href="attendance.html">Attendance</a></li>
                        <li><a href="admin.html">Admin Panel</a></li>
                        <li><a href="#" id="logout-link" class="btn btn-danger">Logout</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="main-content">
        <div class="container">
            <h1 class="page-title">Manage Employees</h1>
            <div id="alert-container"></div>

            <div class="card">
                <h2>Employee Directory</h2>
                <div class="table-container">
                    <table id="employees-table">
                        <thead>
                            <tr>
                                <th>Employee ID</th>
                                <th>Name</th>
                                <th>Department</th>
                                <th>Position</th>
                                <th>Registered</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employees-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card" id="employee-edit-section">
                <h2>Edit Employee</h2>
                <p id="edit-status-message" style="margin-bottom: 1rem; color: var(--gray);">Select an employee above to edit their details.</p>
                <form id="employee-edit-form" class="form-grid">
                    <div class="form-group" style="flex: 1 1 200px;">
                        <label for="edit_employee_id">Employee ID</label>
                        <input type="text" id="edit_employee_id" name="employee_id" readonly required>
                    </div>
                    <div class="form-group" style="flex: 1 1 220px;">
                        <label for="edit_full_name">Full Name</label>
                        <input type="text" id="edit_full_name" name="full_name" required>
                    </div>
                    <div class="form-group" style="flex: 1 1 200px;">
                        <label for="edit_department">Department</label>
                        <select id="edit_department" name="department" required>
                            <option value="">Select Department</option>
                            <option value="hr">Human Resources</option>
                            <option value="it">Information Technology</option>
                            <option value="finance">Finance</option>
                            <option value="marketing">Marketing</option>
                            <option value="operations">Operations</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1 1 200px;">
                        <label for="edit_position">Position</label>
                        <input type="text" id="edit_position" name="position" required>
                    </div>
                    <div class="form-group" style="flex: 1 1 200px; align-self: flex-end;">
                        <button type="submit" class="btn btn-success">Save Changes</button>
                        <button type="button" class="btn btn-danger" onclick="deleteEmployee()" style="margin-left: 0.5rem;">Delete Employee</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2023 Attendance System - Employee Attendance System. All rights reserved.</p>
        </div>
    </footer>

    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/utils.js"></script>
    <script>
        // Check authentication
        if (!auth.requireLogin()) {
            // Redirect will happen in auth.js
        }

        let currentEmployeeId = null;

        document.addEventListener('DOMContentLoaded', function() {
            db.ready.then(() => {
                loadEmployees();

                // Edit form
                document.getElementById('employee-edit-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveEmployee();
                });

                // Logout
                document.getElementById('logout-link').addEventListener('click', function(e) {
                    e.preventDefault();
                    auth.logout();
                    window.location.href = 'admin_login.html';
                });
            });
        });

        function loadEmployees() {
            const employees = db.getEmployees();
            const tbody = document.getElementById('employees-tbody');
            
            if (employees.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No employees registered yet.</td></tr>';
                return;
            }

            tbody.innerHTML = employees.map(emp => {
                const regDate = formatDate(emp.registration_date);
                return `
                    <tr>
                        <td>${emp.employee_id}</td>
                        <td>${emp.full_name}</td>
                        <td>${emp.department.charAt(0).toUpperCase() + emp.department.slice(1)}</td>
                        <td>${emp.position}</td>
                        <td>${regDate}</td>
                        <td>
                            <button class="btn edit-employee-btn" 
                                    onclick="editEmployee('${emp.employee_id}')">
                                Edit
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function editEmployee(employeeId) {
            const employee = db.getEmployee(employeeId);
            if (!employee) {
                showAlert('Employee not found.', 'error');
                return;
            }

            currentEmployeeId = employeeId;
            
            document.getElementById('edit_employee_id').value = employee.employee_id;
            document.getElementById('edit_full_name').value = employee.full_name;
            document.getElementById('edit_department').value = employee.department;
            document.getElementById('edit_position').value = employee.position;
            document.getElementById('edit-status-message').innerHTML = `Editing employee <strong>${employee.employee_id}</strong>.`;

            // Scroll to edit section
            document.getElementById('employee-edit-section').scrollIntoView({ behavior: 'smooth' });
        }

        function saveEmployee() {
            if (!currentEmployeeId) {
                showAlert('Please select an employee to edit.', 'error');
                return;
            }

            const updates = {
                full_name: document.getElementById('edit_full_name').value.trim(),
                department: document.getElementById('edit_department').value,
                position: document.getElementById('edit_position').value.trim()
            };

            if (!updates.full_name || !updates.department || !updates.position) {
                showAlert('All fields are required.', 'error');
                return;
            }

            if (db.updateEmployee(currentEmployeeId, updates)) {
                showAlert('Employee details updated successfully.', 'success');
                loadEmployees();
                // Reset form
                document.getElementById('employee-edit-form').reset();
                document.getElementById('edit-status-message').textContent = 'Select an employee above to edit their details.';
                currentEmployeeId = null;
            } else {
                showAlert('Unable to update employee details. Please try again.', 'error');
            }
        }

        function deleteEmployee() {
            if (!currentEmployeeId) {
                showAlert('Please select an employee to delete.', 'error');
                return;
            }

            if (!confirm('Are you sure you want to delete this employee? This will also delete all their attendance records.')) {
                return;
            }

            if (db.deleteEmployee(currentEmployeeId)) {
                showAlert('Employee deleted successfully.', 'success');
                loadEmployees();
                // Reset form
                document.getElementById('employee-edit-form').reset();
                document.getElementById('edit-status-message').textContent = 'Select an employee above to edit their details.';
                currentEmployeeId = null;
            } else {
                showAlert('Unable to delete employee. Please try again.', 'error');
            }
        }

    </script>
</body>
</html>

